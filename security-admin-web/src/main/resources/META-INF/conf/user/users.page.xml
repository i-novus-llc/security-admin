<?xml version='1.0' encoding='UTF-8'?>
<page xmlns="http://n2oapp.net/framework/config/schema/page-2.0"
      object-id="${access.user.object.id}"
      name="Пользователи">
    <regions>
        <region place="single">
            <table name="Пользователи" query-id="${access.user.query.id}">
                <columns>
                    <column text-field-id="username"/>
                    <column text-field-id="fio"/>
                    <column text-field-id="userLevel.name"/>
                    <column text-field-id="roleNamesWithSystem" label="Роли">
                        <list label-field-id="name"/>
                    </column>
                    <column text-field-id="isActive">
                        <checkbox>
                            <invoke route="/changeUserActive" operation-id="changeUserActive"/>
                        </checkbox>
                    </column>
                    <column text-field-id="actions" label=" ">
                        <toolbar>
                            <sub-menu label="Действие">
                                <menu-item label="Удалить" confirm="true"
                                           confirm-text="Вы действительно хотите удалить пользователя?">
                                    <invoke operation-id="delete"/>
                                </menu-item>
                                <menu-item label="Сбросить пароль">
                                    <show-modal page-id="passwordResetForm" upload="defaults" detail-field-id="id"
                                                object-id="user" submit-operation-id="resetPassword"/>
                                </menu-item>
                            </sub-menu>
                        </toolbar>
                    </column>
                </columns>
                <rows>
                    <click>
                        <show-modal page-id="userUpdateForm" submit-operation-id="update" object-id="user"
                                    detail-field-id="id" route="/:id/update"/>
                    </click>
                </rows>
                <filters>
                    <row>
                        <input-text id="username"/>
                        <input-text id="fio" class="n2o-control-10"/>
                        <input-select id="system" label="Система" visible="${sec.admin.system-enabled}"
                                      query-id="system"/>
                    </row>
                    <row>
                        <input-select id="roles" type="checkboxes" label="Роли"
                                      query-id="${access.role.query.id}" value-field-id="id"
                                      label-field-id="name" group-field-id="systemName">
                            <pre-filters>
                                <eq field-id="system" value="{system.id}"/>
                            </pre-filters>
                        </input-select>
                        <checkbox-group id="activeList" label="Активность" inline="true">
                            <options>
                                <option id="1" name="Да"/>
                                <option id="2" name="Нет"/>
                            </options>
                        </checkbox-group>

                    </row>
                    <row>
                        <!--                        <input-select id="userLevel" label="Уровень пользователя" query-id="userLevel" visible="${user-level.enabled}"/>-->
                        <input-select id="department" label="Департамент" query-id="department"
                                      visible="${user-level.value.federal}"/>
                        <input-select id="region" label="Регион" query-id="region">
                            <dependencies>
                                <visibility apply-on-init="true">${user-level.value.regional} ||
                                    ${user-level.value.org}
                                </visibility>
                            </dependencies>
                        </input-select>
                        <input-select id="organization" label-field-id="shortName" label="Организация"
                                      query-id="organization" visible="${user-level.value.org}"/>
                    </row>
                    <input-text id="isActive" visible="false">
                        <dependencies>
                            <set-value on="activeList" apply-on-init="false">
                                if ((typeof activeList == 'undefined') || (activeList == null) ||
                                (activeList.length==0)) {
                                return null;
                                } else if (activeList.length == 2) {
                                return null;
                                }else if (activeList[0].id == 1) {
                                return 'yes';
                                } else if (activeList[0].id == 2) {
                                return 'no';
                                } else {
                                return null;
                                }
                            </set-value>
                        </dependencies>
                    </input-text>
                </filters>
                <toolbar>
                    <button id="create" label="Создать" color="primary">
                        <show-modal page-id="userForm" submit-operation-id="create" model="filter" object-id="user"
                                    upload="defaults" route="create"/>
                    </button>
                </toolbar>
            </table>
        </region>
    </regions>
</page>
