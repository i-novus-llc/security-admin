<?xml version='1.0' encoding='UTF-8'?>
<query xmlns="http://n2oapp.net/framework/config/schema/query-4.0" object-id="${sec.admin.permission.object.id}" name="Права доступа">
    <list>
        <sql>
            select :select
            from sec.permission
            where :filters
        </sql>
    </list>
    <count>
        <sql>
            select count(p.id)
            from sec.permission
            where :filters
        </sql>
    </count>

    <fields>
        <field id="id" domain="integer">
            <select/>
            <filters>
                <eq filter-id="id"/>
            </filters>
        </field>
        <field id="name" domain="string" name="Название">
            <select/>
            <filters>
                <eq filter-id="name"/>
            </filters>
        </field>
        <field id="code" domain="string" name="Код">
            <select/>
            <filters>
                <eq filter-id="code"/>
            </filters>
        </field>
        <field id="parentId" domain="integer">
            <select>parent_id</select>
        </field>
        <field id="hasChildren" domain="boolean">
            <select mapping="['has_children']">
                coalesce((select true from sec.permission as rp where rp.parent_id = sec.permission.id limit 1),
                false) as has_children
            </select>
        </field>
    </fields>
</query>
