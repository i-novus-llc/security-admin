<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="EPMP-189-20190828-01" author="estartcev">
        <validCheckSum>8:0f461513f7c83a7e871f55ae8d801aef</validCheckSum>
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ext_sys" schemaName="sec" tableName="user"/>
            </not>
        </preConditions>
        <comment>Добавление колонки ext_sys</comment>
        <sql>
            ALTER TABLE sec.user ADD COLUMN ext_sys varchar;
            COMMENT ON COLUMN sec.user.ext_sys IS 'Наимнование SSO';
        </sql>
    </changeSet>

    <changeSet id="EPMP-189-20190829-02" author="estartcev">
        <validCheckSum>8:ae8be1e9327c1a2462d1657096eec549</validCheckSum>
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ext_uid" schemaName="sec" tableName="user"/>
            </not>
        </preConditions>
        <comment>Переименование колонки guid в ext_uid</comment>
        <sql>
            ALTER TABLE sec.user ADD COLUMN ext_uid varchar;
            UPDATE sec.user SET ext_uid = guid;
            ALTER TABLE sec.user DROP COLUMN guid;
        </sql>
    </changeSet>


</databaseChangeLog>