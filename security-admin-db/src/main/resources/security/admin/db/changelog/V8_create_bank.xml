<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="20190115-01" author="tvalieva">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="bank" schemaName="sec"/>
            </not>
        </preConditions>
        <sql>
            create table if not exists sec.bank (
            id uuid NOT NULL,
            full_name varchar NOT NULL,
            short_name varchar NOT NULL,
            reg_num varchar NULL,
            reg_dt timestamp NULL,
            inn varchar NOT NULL,
            ogrn varchar NOT NULL,
            bik varchar NULL,
            kpp varchar NOT NULL,
            legal_address varchar NOT NULL,
            actual_address varchar NULL,
            creation_date timestamp NULL,
            last_action_date timestamp NULL,
            parent_id uuid NULL,
            CONSTRAINT pk_bank PRIMARY KEY (id),
            CONSTRAINT bank_parent_id_fk FOREIGN KEY (parent_id) REFERENCES sec.bank(id)
            );

            comment on table sec.bank is 'Сведения о банке';

            comment on column sec.bank.id is 'Ид-р ';
            comment on column sec.bank.full_name is 'Полное наименование';
            comment on column sec.bank.short_name is 'Сокращенное наименование';
            comment on column sec.bank.reg_num is 'Регистрационный номер';
            comment on column sec.bank.reg_dt is 'Дата регистрации Банком России';
            comment on column sec.bank.inn is 'ИНН';
            comment on column sec.bank.ogrn is 'ОГРН';
            comment on column sec.bank.bik is 'БИК';
            comment on column sec.bank.kpp is 'КПП';
            comment on column sec.bank.legal_address is 'Юридический адрес';
            comment on column sec.bank.actual_address is 'Фактический адрес';
            comment on column sec.bank.parent_id is 'Головная организация';

        </sql>
    </changeSet>


    <changeSet id="20190110-03" author="tvalieva">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="user" columnName="creation_date" schemaName="sec"/>
            </not>
        </preConditions>
        <addColumn tableName="user" schemaName="sec">
            <column name="creation_date" type="timestamp without time zone"
                    remarks="Дата создания записи"/>
        </addColumn>
    </changeSet>

    <changeSet id="20190110-04" author="tvalieva">
        <sql>
            create table if not exists sec.employee_bank (
            id uuid NOT NULL,
            position varchar ,
            bank_id uuid,
            user_id integer,
            creation_date timestamp,
            last_action_date timestamp,
            CONSTRAINT pk_employee_bank PRIMARY KEY (id),
            CONSTRAINT employee_bank_bank_id_id_fk FOREIGN KEY (bank_id) REFERENCES sec.bank(id),
            CONSTRAINT employee_bank_user_id_id_fk FOREIGN KEY (user_id) REFERENCES sec.user(id)
            );
            comment on table sec.employee_bank is 'Уполномоченные лица Банк';

            comment on column sec.employee_bank.id is 'Ид-р ';
            comment on column sec.employee_bank.position is 'Должность';
            comment on column sec.employee_bank.bank_id is 'Идентификатор банка';
            comment on column sec.employee_bank.user_id is 'Идентификатор пользователя';

        </sql>
    </changeSet>

    <changeSet id="20190115-02" author="abelov">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="user" columnName="last_action_date" schemaName="sec"/>
            </not>
        </preConditions>
        <addColumn tableName="user" schemaName="sec">
            <column name="last_action_date" type="timestamp without time zone" remarks="Дата последнего изменения записи"/>
        </addColumn>
    </changeSet>

</databaseChangeLog>