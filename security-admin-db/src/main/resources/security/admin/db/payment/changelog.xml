<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="payment_init_permissions" author="dbilalov" dbms="postgresql">
        <sql>
            insert into sec.permission(name, code) select 'Доступ к модулю "Оплата"', 'payment' where not exists (select 1 from sec.permission where code = 'payment');
            insert into sec.permission(name, code, parent_id) select 'Доступ к модулю "Оплата". Банки', 'payment.bank', (select id from sec.permission where code = 'payment') where not exists (select 1 from sec.permission where code = 'payment.bank');
            insert into sec.permission(name, code, parent_id) select 'Доступ к модулю "Оплата". ДОМ.РФ', 'payment.domrf', (select id from sec.permission where code = 'payment') where not exists (select 1 from sec.permission where code = 'payment.domrf');

            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". Банки. Просмотр своих договоров', 'payment.bank.contract.read', (select id from sec.permission where code = 'payment.bank') where not exists (select 1 from sec.permission where code = 'payment.bank.contract.read');
            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". Банки. Просмотр всех договоров', 'payment.bank.contract.read.all', (select id from sec.permission where code = 'payment.bank') where not exists (select 1 from sec.permission where code = 'payment.bank.contract.read.all');
            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". Банки. Изменение уполномоченного лица банка по договору', 'payment.bank.contract.employee.edit', (select id from sec.permission where code = 'payment.bank') where not exists (select 1 from sec.permission where code = 'payment.bank.contract.employee.edit');

            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". ДОМ.РФ. Просмотр своих договоров', 'payment.domrf.contract.read', (select id from sec.permission where code = 'payment.domrf') where not exists (select 1 from sec.permission where code = 'payment.domrf.contract.read');
            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". ДОМ.РФ. Просмотр всех договоров', 'payment.domrf.contract.read.all', (select id from sec.permission where code = 'payment.domrf') where not exists (select 1 from sec.permission where code = 'payment.domrf.contract.read.all');
            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". ДОМ.РФ. Изменение уполномоченного лица ДОМ.РФ по договору', 'payment.domrf.contract.employee.edit', (select id from sec.permission where code = 'payment.domrf') where not exists (select 1 from sec.permission where code = 'payment.domrf.contract.employee.edit');

            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". ДОМ.РФ. Добавление договора поручительства', 'payment.domrf.contract.add', (select id from sec.permission where code = 'payment.domrf') where not exists (select 1 from sec.permission where code = 'payment.domrf.contract.add');
            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". ДОМ.РФ. Выполнение операций по договору', 'payment.domrf.contract.operation.execute', (select id from sec.permission where code = 'payment.domrf') where not exists (select 1 from sec.permission where code = 'payment.domrf.contract.operation.execute');
            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". ДОМ.РФ. Удаление операций по договору', 'payment.domrf.contract.operation.delete', (select id from sec.permission where code = 'payment.domrf') where not exists (select 1 from sec.permission where code = 'payment.domrf.contract.operation.delete');
            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". ДОМ.РФ. Изменение статуса договора', 'payment.domrf.contract.status.edit', (select id from sec.permission where code = 'payment.domrf') where not exists (select 1 from sec.permission where code = 'payment.domrf.contract.status.edit');
            insert into sec.permission(name, code, parent_id)
            select 'Модуль "Оплата". ДОМ.РФ. Удаление договора поручительства', 'payment.domrf.contract.delete', (select id from sec.permission where code = 'payment.domrf') where not exists (select 1 from sec.permission where code = 'payment.domrf.contract.delete');
        </sql>
    </changeSet>

</databaseChangeLog>